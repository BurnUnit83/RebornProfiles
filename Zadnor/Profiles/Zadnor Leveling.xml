<?xml version="1.0" encoding="utf-8"?>
<!--
  Profile: Zadnor Leveling
  Authors: DomesticWarlord86
  
  Confirmed Zone 1:
  ID: 1717 Type: Bozja_Boss Fate: Of Beasts and Braggadocio 
  Fate: 1718 Parts and Parcel Bozja_Gather *Blacklist as it's a pickup
  Fate: 1719 An Immoral Dilemma Bozja_Boss  
  ID: 1720 Type: Bozja_Boss Fate: Deadly Divination 
  ID: 1721 Type: Bozja_Slay Fate: A Wrench in the Reconnaissance Effort 
  ID: 1722 Type: Bozja_Boss Fate: Another Pilot Episode 
  Fate: 1723 Breaking the Ice Bozja_Slay
  ID: 1724 Type: Bozja_Slay Fate: Meet the Puppetmaster  

  Confirmed Zone 2:
  ID: 1725 Type: Bozja_Boss Fate: Challenge Accepted 
  ID: 1728 Type: Bozja_Boss Fate: A Just Pursuit   
  ID: 1730 Type: Bozja_Boss Fate: Supersoldier Rising 
  ID: 1731 Type: Bozja_Boss Fate: Demented Mentor 
  
  
 Fate: 1728 A Just Pursuit Bozja_Boss
 Fate: 1720 Deadly Divination Bozja_Boss
Fate: 1719 An Immoral Dilemma Bozja_Boss
Fate: 1732 Sever the Strings Bozja_Boss
Fate: 1721 A Wrench in the Reconnaissance Effort Bozja_Slay 
Fate: 1734 Still Only Counts as One Bozja_Boss
Fate: 1725 Challenge Accepted Bozja_Boss
ID: 1741 Type: Bozja_Boss Fate: The Student Becalms the Master 
			 
-->
<Profile>
  <Name>Zadnor Leveling</Name>
  <BehaviorDirectory></BehaviorDirectory>
  <Order>
  
	<RunCode name="Disable_Flight"/>
	
	<If Condition="not IsOnMap(975)">  
		<If Condition="not IsOnMap(915)">	
			<While Condition="not IsOnMap(759)">
				<TeleportTo AetheryteId="127"/> <!-- The Doman Enclave -->
			</While>				
			<GetTo ZoneId="759" XYZ="126.2195, -4.178713, 97.66013"/>
			<UseTransport NpcId="1032884" InteractDistance="3.0" XYZ="127.2754, -4.178713, 98.68005"/>
		</If>
		<MoveTo ZoneId="915" XYZ="-27.72526, -0.5876654, -33.76041"/>
		<RunCode name="EnterZadnor"/>
	</If>  
  
	<While Condition="IsOnMap(975)">
		<Log Message="Starting Bozjan Leveling..." />
		
			<!-- Rank up if ready -->
			<If condition="CurrentMettle() &gt; NextResistanceRank() and Core.Me.ElementalLevel &lt; 25">
			  <Log Message="We have enough Mettle to rank up, doing so..." />
				<If condition="ActionManager.IsReturnReady">
					<Log Message="Return is ready, let's take the easy way back..." />
					<RunCode name="Return"/>
				</If>		  
			  <MoveTo XYZ="658.2029, 296.0164, 675.5206" />
			  <RunCode name="RankUp"/>
			  <LLSmallTalk/>
			</If>		
			
			<!-- Complete 'A New Playing Field' if not done -->	
			<If Condition="not IsQuestCompleted(69620)">
				<Log Message="Loading 'A New Playing Field'..." />
				<LLoadProfile Path="../Quests/A New Playing Field.xml"/>
			</If>
			
			<!-- Grind to Rank 16 -->
			<While condition="Core.Me.ElementalLevel == 15 and CurrentMettle() &lt; NextResistanceRank()">
				<Log Message="Doing Fates to grind Mettle to Rank 16..." />
				<LLFate FateIds="1717,1719,1720,1721,1722,1723,1724" UseFlight="False" MinLevel="0" MaxLevel="81" while="IsOnMap(975) and CurrentMettle() &lt; NextResistanceRank() and Character.IsAlive and Core.Me.ElementalLevel &lt; 16"/>	
			</While>
			
			<!-- Complete 'Resolve Unshaken' if not done -->	
			<If condition="Core.Me.ElementalLevel &gt; 15 and not IsQuestCompleted(69621)">
				<Log Message="Loading 'Resolve Unshaken'..." />
				<LLoadProfile Path="../Quests/Resolve Unshaken.xml"/>			
			</If>

			<!-- Grind to Rank 18 -->
			<While condition="Core.Me.ElementalLevel &lt; 18 and CurrentMettle() &lt; NextResistanceRank()">
				<Log Message="Doing Fates to grind Mettle to Rank 18..." />
				<LLFate FateIds="1717,1719,1720,1721,1722,1723,1724" UseFlight="False" MinLevel="0" MaxLevel="81" while="IsOnMap(975) and CurrentMettle() &lt; NextResistanceRank() and Character.IsAlive and Core.Me.ElementalLevel &lt; 18"/>	
			</While>			

			<!-- Complete 'Where Eagles Roost' if not done -->	
			<If condition="Core.Me.ElementalLevel &gt; 17 and not IsQuestCompleted(69628)">
				<Log Message="Loading 'Where Eagles Roost'..." />
				<LLoadProfile Path="../Quests/Where Eagles Roost.xml"/>			
			</If>
			
			<!-- Grind to Rank 20 -->
			<While condition="Core.Me.ElementalLevel &lt; 20 and CurrentMettle() &lt; NextResistanceRank()">
				<Log Message="Doing Fates to grind Mettle to Rank 20..." />
				<LLFate FateIds="1717,1719,1720,1721,1722,1723,1724,1725,1728,1730,1731" UseFlight="False" MinLevel="0" MaxLevel="81" while="IsOnMap(975) and CurrentMettle() &lt; NextResistanceRank() and Character.IsAlive and Core.Me.ElementalLevel &lt; 20"/>	
			</While>

			<!-- Complete 'Reaching Out' if not done -->	
			<If condition="Core.Me.ElementalLevel &gt; 19 and not IsQuestCompleted(69622)">
				<Log Message="Loading 'Reaching Out'..." />
				<LLoadProfile Path="../Quests/Reaching Out.xml"/>			
			</If>			

			<!-- Grind to Rank 25 -->
			<While condition="Core.Me.ElementalLevel &lt; 25 and CurrentMettle() &lt; NextResistanceRank()">
				<Log Message="Doing Fates to grind Mettle to Rank 25..." />
				<LLFate FateIds="1717,1719,1720,1721,1722,1723,1724,1725,1728,1730,1731" UseFlight="False" MinLevel="0" MaxLevel="81" while="IsOnMap(975) and CurrentMettle() &lt; NextResistanceRank() and Character.IsAlive and Core.Me.ElementalLevel &lt; 25"/>	
			</While>			
	</While>
		
  
  </Order>
  <GrindAreas>
  </GrindAreas>
  <CodeChunks>
		<CodeChunk Name="EnterZadnor">
			<![CDATA[
				var npcId = GameObjectManager.GetObjectByNPCId(1032080);

					if (!npcId.IsWithinInteractRange)

						{
							var _target = npcId.Location;
							Navigator.PlayerMover.MoveTowards(_target);
							while (_target.Distance2D(Core.Me.Location) >= 4)
								{
									Navigator.PlayerMover.MoveTowards(_target);
									await Coroutine.Sleep(100);
								}
									Navigator.PlayerMover.MoveStop();
								}

					npcId.Interact();

					await Coroutine.Wait(10000, () => SelectString.IsOpen);
					await Buddy.Coroutines.Coroutine.Sleep(500);
					{
						Logging.WriteDiagnostic("Selecting 'Zadnor'.");
						ff14bot.RemoteWindows.SelectString.ClickSlot(0);
						await Coroutine.Wait(10000, () => SelectString.IsOpen);
						await Buddy.Coroutines.Coroutine.Sleep(500);
						{
							Logging.WriteDiagnostic("Selecting 'Enter Zadnor'.");
							ff14bot.RemoteWindows.SelectString.ClickSlot(0);
						}													
					}										

					await Coroutine.Wait(5000, () => ContentsFinderConfirm.IsOpen);
					await Buddy.Coroutines.Coroutine.Sleep(500);
				   
					if (ff14bot.RemoteWindows.ContentsFinderConfirm.IsOpen)						
						{
							Logging.WriteDiagnostic("Commencing Duty.");
							ff14bot.RemoteWindows.ContentsFinderConfirm.Commence();
							await Coroutine.Wait(10000, () => CommonBehaviors.IsLoading);
							   if (CommonBehaviors.IsLoading)
							   {
								   await Coroutine.Wait(-1, () => !CommonBehaviors.IsLoading);
							   }									
						}			
			]]>			
		</CodeChunk>  
		<CodeChunk Name="RankUp">
			<![CDATA[
				var npcId = GameObjectManager.GetObjectByNPCId(1036720);

					if (!npcId.IsWithinInteractRange)

						{
							var _target = npcId.Location;
							Navigator.PlayerMover.MoveTowards(_target);
							while (_target.Distance2D(Core.Me.Location) >= 4)
								{
									Navigator.PlayerMover.MoveTowards(_target);
									await Coroutine.Sleep(100);
								}
									Navigator.PlayerMover.MoveStop();
								}

					npcId.Interact();
					
					await Coroutine.Wait(5000, () => Talk.DialogOpen);
					await Buddy.Coroutines.Coroutine.Sleep(500);
					while (await Coroutine.Wait(1000, () => Talk.DialogOpen))
					{
						Talk.Next();
						await Coroutine.Wait(5000, () => !Talk.DialogOpen);
						await Buddy.Coroutines.Coroutine.Sleep(1000);
					}				

					await Coroutine.Wait(10000, () => SelectString.IsOpen);
					await Buddy.Coroutines.Coroutine.Sleep(500);
					{
						Logging.WriteDiagnostic("Choosing 'Offer proof of your mettle.");
						ff14bot.RemoteWindows.SelectString.ClickSlot(0);
					}					

					await Coroutine.Wait(5000, () => Talk.DialogOpen);
					await Buddy.Coroutines.Coroutine.Sleep(500);
					while (Talk.DialogOpen)
					{
						Talk.Next();
						await Coroutine.Wait(500, () => !Talk.DialogOpen);
						await Coroutine.Wait(500, () => Talk.DialogOpen);
						await Coroutine.Yield();
					}	
				
			]]>			
		</CodeChunk>
		<CodeChunk Name="Return">
			<![CDATA[
				ActionManager.DoAction(ActionType.General, 8, Core.Me);
				await Coroutine.Sleep(1000);
				ff14bot.RemoteWindows.SelectYesno.ClickYes();
				await Coroutine.Sleep(4000);
				await Coroutine.Wait(20000, () => CommonBehaviors.IsLoading);
				if (CommonBehaviors.IsLoading)
				{
					await Coroutine.Wait(-1, () => !CommonBehaviors.IsLoading);
				}
		  ]]>
		</CodeChunk>
		<CodeChunk Name="Disable_Flight">
		<![CDATA[
			foreach (var plugin in PluginManager.Plugins.Where(p => p.Plugin.Name == "Enable Flight" || p.Plugin.Name == "启用飞行"))
			{
			try
			{
				if (!plugin.Enabled)  {  break;  }  else  {  plugin.Enabled = false;  }
			}
			catch (Exception ex) {  }
			}
		]]>
		</CodeChunk>		
  </CodeChunks>
</Profile>  